<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Space of Olympics Games</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <script src="http://mbostock.github.com/d3/d3.v2.js?2.9.6"></script>
    <link type="text/css" href="style.css?0" rel="stylesheet" />
    <script type="text/javascript"></script>
    <style></style>
    <!--[if gte IE 9]>
      <style type="text/css">
        .gradient {
           filter: none;
        }
      </style>
    <![endif]-->
</head>
<body onload="init()">
    <div id="about" class="popup">
        <span>About</span>
        <div>
            <h1>Space of Olympics Games</h1>
            <p>
                I imagined that every Olympic game is a galaxy of stars...<br/>
                And after some searching and thought it turned out that there are.<br/>
                Good luck!<br/>
                <hr>
                If you have questions, then welcome to my email <a href="mailto:artzub@gmail.com">Artem Zubkov</a> =)
            </p>
            <h2></h2>
            <p>
            </p>
            <h2>How to use</h2>
            <p>
                <ul>
                    <li><strong>Scroll</strong> - increase / decrease
                    <li>Button at top left change mode stars off or on.
                </ul>
            </p>
        </div>
    </div>
    <div id="filters" class="popup">
        <span>Filters</span>
        <div>
            <ul class="filtercont">
                <li>
                    <h3>Athletes</h3>
                    <ul id="athletescont"></ul>
                </li>
                <li>
                    <h3>Countries</h3>
                    <ul id="countriescont"></ul>
                </li>
                <li>
                    <h3>Sports</h3>
                    <ul id="sportscont"></ul>
                </li>
            </ul>
        </div>
    </div>
    <svg
        xmlns:svg="http://www.w3.org/2000/svg"
        xmlns="http://www.w3.org/2000/svg"
        xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
        >
        <defs id="starsFirst" xmlns="http://www.w3.org/2000/svg">
            <filter id="filter5909" color-interpolation-filters="sRGB">
                <feColorMatrix id="feColorMatrix5911" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0 " result="result7"/>
                <feGaussianBlur id="feGaussianBlur5913" result="result6" stdDeviation="5"/>
                <feComposite id="feComposite5915" in2="result7" operator="atop" in="result6" result="result91"/>
                <feComposite id="feComposite5917" in2="result91" operator="in"/>
            </filter>
            <filter id="filter4888-1" color-interpolation-filters="sRGB">
                <feGaussianBlur id="feGaussianBlur4890-2" stdDeviation="5" result="result1"/>
                <feComposite k4="0" k3="0" k1="0" id="feComposite4892-6" in2="result1" operator="arithmetic" k2="2" in="result1"/>
            </filter>
            <clipPath id="clipPath116341" clipPathUnits="userSpaceOnUse">
              <path inkscape:connector-curvature="0" id="path116343" d="m 254.487,230.377 8.162,0 0,-8.159 -8.162,0 0,8.159 z"/>
            </clipPath>
        </defs>
        <defs id="starsZero" xmlns="http://www.w3.org/2000/svg">
            <filter color-interpolation-filters="sRGB" id="filter6197" x="-0.28238368" width="1.5647674" y="-0.26952863" height="1.5390573">
              <feGaussianBlur stdDeviation="4.7044925" id="feGaussianBlur6199"/>
            </filter>
            <filter id="filter6115" color-interpolation-filters="sRGB">
              <feGaussianBlur id="feGaussianBlur6117" stdDeviation="5" result="result1"/>
              <feComposite k4="0" k3="0" k1="0" id="feComposite6119" in2="result1" operator="arithmetic" k2="2" in="result1"/>
            </filter>
        </defs>
        <defs id="starsSecond">
            <linearGradient id="linearGradient3899">
              <stop style="stop-color:#ffffff;stop-opacity:1;" offset="0" id="stop3901"/>
              <stop style="stop-color:#ffffff;stop-opacity:0;" offset="1" id="stop3903"/>
            </linearGradient>
            <filter id="filter3831" inkscape:label="Noisy blur" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" inkscape:menu="Blurs" inkscape:menu-tooltip="Small-scale roughening and blurring to edges and content" x="-0.25" width="1.5" y="-0.25" height="1.5" color-interpolation-filters="sRGB">
              <feGaussianBlur id="feGaussianBlur3833" stdDeviation="5" result="result1"/>
              <feTurbulence id="feTurbulence3835" numOctaves="1" seed="0" type="fractalNoise" baseFrequency="0.1" result="result2"/>
              <feDisplacementMap id="feDisplacementMap3837" in2="result2" scale="5" yChannelSelector="G" xChannelSelector="R" result="result3" in="result1"/>
              <feComposite id="feComposite3839" in2="result3" operator="atop"/>
            </filter>
            <filter id="filter3859" inkscape:label="Noisy blur" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" inkscape:menu="Blurs" inkscape:menu-tooltip="Small-scale roughening and blurring to edges and content" color-interpolation-filters="sRGB" x="-0.25" width="1.5" y="-0.25" height="1.5">
              <feTurbulence id="feTurbulence3861" type="fractalNoise" numOctaves="5" baseFrequency="0.02" result="result1"/>
              <feComposite id="feComposite3863" in2="result1" operator="in" result="result2" in="SourceGraphic"/>
              <feColorMatrix id="feColorMatrix3865" result="fbSourceGraphic" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 3 -1 " in="result2"/>
              <feColorMatrix result="fbSourceGraphicAlpha" in="fbSourceGraphic" values="0 0 0 -1 0 0 0 0 -1 0 0 0 0 -1 0 0 0 0 1 0" id="feColorMatrix3867"/>
              <feGaussianBlur id="feGaussianBlur3869" stdDeviation="5" result="result1" in="fbSourceGraphic"/>
              <feTurbulence id="feTurbulence3871" numOctaves="1" seed="0" type="fractalNoise" baseFrequency="0.1" result="result2"/>
              <feDisplacementMap id="feDisplacementMap3873" in2="result2" scale="5" yChannelSelector="G" xChannelSelector="R" result="result3" in="result1"/>
              <feComposite id="feComposite3875" in2="result3" operator="atop"/>
            </filter>
            <radialGradient xlink:href="#linearGradient3899" id="radialGradient3982" gradientUnits="userSpaceOnUse" spreadMethod="reflect" cx="83.842659" cy="75.54467" fx="83.842659" fy="75.54467" r="58.831825"/>
        </defs>
    </svg>
<script>
var init = function() {
    var margin = {top:10, right:10, bottom:10, left:10},
        width = function() { return window.innerWidth - margin.left - margin.right },
        height = function() { return window.innerHeight - margin.top - margin.bottom },
        zoomLevel = -5.5,
        scale = Math.pow(Math.sqrt(2), zoomLevel),
        sizeFactor = scale * Math.pow(scale, -.15),
        edgeSizeFactor = sizeFactor,
        nodeSizeFactor = sizeFactor,
        centerX = width() / 2,
        centerY = height() / 2,
        lastZoom = 1,
        delx = centerX - (centerX * scale),
        dely = centerY - (centerY * scale),
        lastTranslate = [0, 0],
        showAsBall = true,
        showStat = false,
        showLabelOnRoot = true;


    function resize() {
        scale = Math.pow(Math.sqrt(2), zoomLevel),
        sizeFactor = scale * Math.pow(scale, -.15),
        edgeSizeFactor = sizeFactor,
        nodeSizeFactor = sizeFactor,
        centerX = width() / 2,
        centerY = height() / 2,
        delx = centerX - (centerX * scale),
        dely = centerY - (centerY * scale);
    }

    var color = d3.scale.category20c();
    var cAthletes = d3.scale.category20();
    var cSports = d3.scale.category20();

    var cord = function(c, s) {
        return c - (c - c / s)
    }

    var vis = function(x, y) {
        var w = width(),
            h = height(),
            dx = cord(lastTranslate[0], lastZoom),
            dy = cord(lastTranslate[1], lastZoom),
            x1 = x,
            y1 = y;

        return x1 > -dx && x1 < -dx + cord(w, lastZoom)
            && y1 > -dy && y1 < -dy + cord(h, lastZoom);
    }

    var zoom = d3.behavior.zoom()
            .translate(lastTranslate)
            .scale(lastZoom)
            .scaleExtent([0.1, 8]);

    var svg = d3.select("body").select("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("width", width)
            .attr("height", height)
            .call(zoom)
            .append("g")
            .attr("transform", "scale(1)translate(" + [0 , 0] + ")")
            .attr("width", width)
            .attr("height", height);

    var svgnode = svg.append("g");
    var svglabel = svg.append("g");

    var radius = d3.scale.sqrt()
            .range([0, 4]);

    var sw = d3.scale.sqrt()
            .range([0.01, 0.2]);

    d3.json("graph.json", function (graph) {

        zoom.on("zoom", zoomMove);

        var repaintTimer = false;

        function zoomMove() {

            if (repaintTimer && !(lastZoom != s || lastTranslate[0] != t[0] || lastTranslate[1] != t[1])) {
                clearTimeout(repaintTimer);
                repaintTimer = false;
            }

            d3.select("body").select("svg")
                .attr("width", width)
                .attr("height", height);

            var t = d3.event.translate,
                s = d3.event.scale,
                needZoom = true,
                needMove = true;

            var dz = s / 1000;
            resize();
            svg
              .attr("transform", "scale(" + s + ")translate(" + [cord(t[0], s), cord(t[1], s)] + ")");
            if (lastZoom != s || lastTranslate[0] != t[0] || lastTranslate[1] != t[1])
                repaintTimer = setTimeout(makeSmallStars, 500);
            lastTranslate = t.slice(0);
            lastZoom = s;
            refresh();
        }

        function refresh() {
            svg.selectAll(".link path")
               .style("stroke-width", function(m) { return sw(m.target().size) * nodeSizeFactor * 8/lastZoom });
            svg.selectAll(".nodelabel")
                    .style("font-size", 24 / lastZoom + "pt")
                    .style("stroke-width", function(d) { return sw(d.size) * edgeSizeFactor / lastZoom})
                    .style("visibility", function(d) {return d.type == 0 && showLabelOnRoot ? null : "hidden"});
        }

        var stars = {};

        function calcColor(d) {
            return (d.type + d.size * d.tag.split(',').length) / 20;
        }

        var countNodes = graph.nodes.length;
        var proc = 0;

        svg.append("g")
            .attr("id", "stateCont")
            .attr("transform", "translate(" + [centerX, centerY] + ")")
            .append("text")
            .attr("id", "stateLabel")
            .style("fill", "#fff")
            .attr("dy", ".35em")
            .attr("text-anchor", "middle")
            .text("Completed");

        graph.nodes.forEach(function(d) {
            d.rx = elx(scale * d.x + delx, scale * d.y + dely),
            d.ry = ely(scale * d.y + dely, scale * d.x + delx, d.size, d.type);
            d.date = new Date(d.date);
            color(calcColor(d));
            radius(d.size);
            sw(d.size);
        });

        graph.edges.forEach(function(d) {
            d.si = d.source.index;
            d.ti = d.target.index;
            d.source = function() { return graph.nodes[this.si]; };
            d.target = function() { return graph.nodes[this.ti]; };
        });

        function elx(x, y) {
            return x;//Math.sqrt(Math.pow(y * 0.1, 3) + 150 * 0.1 * y + 50);
        }

        function ely(y, x, a, b) {
            return y//Math.sqrt(Math.pow(x * 0.1, 3) + a * 0.1 * x + b);
        }

        function tick() {
            d3.select("#stateCont")
                .style("visibility", null);
            d3.select("#stateLabel")
                .text(Math.round(proc++ * 100000 / countNodes) / 1000 + "% left...");
        }

        function tick_start() {
        }

        function translateNode(node) {
            if (node)
                node
                    .attr("transform", function (d) {
                        return "translate(" + [d.rx , d.ry] + ")";
                    });

            if (stars.zeroGreatness)
                stars.zeroGreatness
                    .attr("transform", function (d) {
                        return "scale(" + 0.05 * nodeSizeFactor * radius(d.size) + ")"
                    });
            if (stars.firstGreatness)
                stars.firstGreatness
                    .attr("transform", function (d) {
                        return "scale(" + 0.05 * nodeSizeFactor * radius(d.size) + ")"
                    });

            if (stars.firstGreatnessOver)
                stars.firstGreatnessOver
                    .attr("transform", function (d) {
                        return "scale(" + 0.05 * nodeSizeFactor * radius(d.size) + ")"
                    });

            if (stars.secondGreatness)
                stars.secondGreatness
                    .attr("transform", function (d) {
                        return "scale(" + 0.05 * nodeSizeFactor * radius(d.size) + ")"
                    });
            if (stars.secondGreatnessOver)
                stars.secondGreatnessOver
                        .attr("transform", function (d) {
                            return "scale(" + 0.05 * nodeSizeFactor * radius(d.size) + ")"
                        });
            if (stars.thirdGreatness)
                stars.thirdGreatness
                    .attr("transform", function (d) {
                        return "scale(" + 0.1 * nodeSizeFactor * radius(d.size * d.tag.split(",").length) + ")"
                    });

            if (stars.thirdGreatnessOver)
                stars.thirdGreatnessOver
                    .attr("transform", function (d) {
                        return "scale(" + 0.5 * nodeSizeFactor * radius(d.size * d.tag.split(",").length) + ")"
                    });
        }

        function showedges(d) {
            hideedges(d);
            var arr = [];
            if (d instanceof Array) {
                arr = d.slice(0);
            }
            else {
                arr.push(d);
            }


            d = arr.pop();
            while(d) {
                graph.edges.
                    filter(function(m) {
                        return (m.si == d.index || m.ti == d.index) && m.target().visibile && m.source().visibile;
                }).forEach(function(l) {
                    svgnode
                        .insert("g", ":first-child")
                        .datum(l)
                        .attr("class", "link")
                        .append("path")
                        .style("stroke", function(m) { return d3.rgb(color(calcColor(m.target())))/*.brighter()*/.toString(); })
                        .style("stroke-width", function(m) { return sw(m.target().size) * nodeSizeFactor * 8/lastZoom })
                        .attr("d", function(m) {
                            var xs = m.source().rx,
                                ys = m.source().ry,
                                xt = m.target().rx,
                                yt = m.target().ry;

                            var x3 = .3 * yt - .3 * ys + .8 * xs + .2 * xt;
                            var y3 = .8 * ys + .2 * yt - .3 * xt + .3 * xs;
                            var x4 = .3 * yt - .3 * ys + .2 * xs + .8 * xt;
                            var y4 = .2 * ys + .8 * yt - .3 * xt + .3 * xs;

                            return "M " + xs + "," + ys + " C " + x3 + "," + y3 + " " + x4 + "," + y4 + " " + xt + "," + yt;
                        });
                })
                svgnode.selectAll(".nodelabel").style("visibility", function(b) {
                    return b.index == d.index ? null : d3.select(this).style("visibility")});
                d = arr.pop();
            }
        }

        function hideedges(d) {
            svgnode.selectAll(".link").remove();
            refresh();
        }

        function makeBigStars() {
            resize();

            svg.select("#stateCont")
                .style("visibility", "hidden");

            stars.zeroGreatness = false;
            stars.firstGreatness = false;
            stars.secondGreatness = false;
            stars.thirdGreatness = false;

            proc = 0;
            graph.nodes
                .forEach(function(d) {
                    d.visibile = d.type < 2;
                });

            svgnode.selectAll(".nodesmall").remove();
            svgnode.selectAll(".nodebig").remove();

            var node = svgnode.selectAll(".nodebig")
                    .data(graph.nodes
                        .filter(function(d) {return d.visibile && d.type < 2;}))
                    .enter().append("g")
                    .attr("class", "nodebig node")
                    .on("mouseover", showedges)
                    .on("mouseout", hideedges);

            if (!stars.zeroGreatness) {
                stars.zeroGreatness = makeStars(node.filter(function(d) { return d.type == 0 }), showAsBall ? 5 : 0);
                if (showAsBall)
                    stars.zeroGreatness = false;
            }
            if (!stars.firstGreatness) {
                stars.firstGreatness = makeStars(node.filter(function(d) { return d.type == 1 }), showAsBall ? 5 : 1);
                if (showAsBall)
                    stars.firstGreatness = false;
            }

            translateNode(node);

            if (lastZoom > 3)
                makeSmallStars();
        }

        function makeSmallStars() {
            repaintTimer = false;
            resize();

            svg.select("#stateCont")
                .style("visibility", "hidden");

            stars.secondGreatness = false;
            stars.thirdGreatness = false;

            proc = 0;

            svgnode.selectAll(".nodesmall").filter(function(d) {
                return !((d.type == 2 && lastZoom > 3) || (d.type == 3 && lastZoom > 5)) || !vis(d.rx, d.ry);
            }).remove();

            node = svgnode.selectAll(".nodesmall");

            graph.nodes
                .forEach(function(d) {
                    var needVis = d.type > 1;
                    if (needVis) {
                        d.drawn = d.visibile;
                        d.needDel = !((d.type == 2 && lastZoom > 3) || (d.type == 3 && lastZoom > 5));
                        d.visibile = !d.needDel && vis(d.rx, d.ry);
                        if (d.drawn && !d.visibile)
                            d.drawn = !(d.needDel = true);
                        needVis = d.visibile && !d.drawn;
                    }
                    if (needVis) {
                        svgnode.append("g")
                            .on("mouseover", showedges)
                            .on("mouseout", hideedges)
                            .attr("class", "nodesmall node")
                            .datum(d);
                    }
                })

            var node = svgnode.selectAll(".nodesmall");

            if (!stars.secondGreatness) {
                stars.secondGreatness = makeStars(node.filter(function(d) {
                    return d.type == 2 && this.childNodes.length < 1
                }), showAsBall ? 5 : 2);
                if (showAsBall)
                    stars.secondGreatness = false;
            }
            if (!stars.thirdGreatness) {
                stars.thirdGreatness = makeStars(node.filter(function(d) {
                    return d.type == 3 && this.childNodes.length < 1
                }), showAsBall ? 5 : 3);
                if (showAsBall)
                    stars.thirdGreatness = false;
            }

            translateNode(node);
        }

        function tick_end() {
            makeLabel();
            makeBigStars();
        }
        setTimeout(tick_end, 10);
        buttonStarOffOn();
        buttonStat();
        buttonLabelRoot();
        initFilters("#athletescont", 3, stars.thirdGreatnessOver, 16, cAthletes);
        initFilters("#sportscont", 1, stars.firstGreatnessOver, 2, cSports);

        function makeLabel() {
        }

        function makeStars(parent, typeStars) {
            if (!parent)
                return parent;

            var newParent = parent;

            switch (typeStars) {
                case 0 :
                    var dpath = function(d) {
                        var cof = Math.random() * d.size * 0.01;
                        var coord = [[0,27.89459],
                                     [-22.61303,50.50763],
                                     [-50.507621,50.50763],
                                     [-27.894591,0],
                                     [-50.507626,-22.61304],
                                     [-50.507626,-50.50763],
                                     [0,-27.894591],
                                     [22.613035,-50.507625],
                                     [50.507626,-50.507625],
                                     [27.894591,0],
                                     [50.507621,22.613034],
                                     [50.507621,50.507625]];
                        var path = "m 134.35028,75.54467 c ";
                        coord.forEach(function(m) {
                            m[0] += Math.random() * 0.02 + d.size * 0.2;
                            m[1] += Math.random() * 0.02 + d.size * 0.2;
                            path += m + " ";
                        });
                        return path + "z";
                    }

                    newParent = parent.append("g")
                            .style("opacity", 0)
                            .attr("class", "stars2");
                    newParent.append("g")
                            .attr("transform", "translate(-140, -58)")
                            .append("g")
                            .attr("class", "outter")
                            //.attr("transform", "translate(-157.5838,-167.68533)")
                            .append("path")
                            .attr("transform", "matrix(1.5656854,0,0,0.75958369,9.13997,-4.06119)")
                            .attr("sodipodi:sodipodi:ry", "50.507626")
                            .attr("sodipodi:sodipodi:rx", "50.507626")
                            .attr("sodipodi:sodipodi:cy", "75.54467")
                            .attr("sodipodi:sodipodi:cx", "83.842659")
                            .attr("sodipodi:sodipodi:type", "arc")
                            .attr("d", "m 134.35028,75.54467 c 0,27.89459 -22.61303,50.50763 -50.507621,50.50763 -27.894591,0 -50.507626,-22.61304 -50.507626,-50.50763 0,-27.894591 22.613035,-50.507625 50.507626,-50.507625 27.894591,0 50.507621,22.613034 50.507621,50.507625 z")
                            .style("opacity", 0.6)
                            .style("fill", function(d) { return color(calcColor(d)) })
                            .style("filter", "url(#filter3859)");
                    newParent.selectAll(".outter").append("path")
                            .attr("transform", "matrix(-0.81901553,0.04016906,-0.02181049,-0.44469885,227.01302,84.54806)")
                            .attr("sodipodi:sodipodi:ry", "50.507626")
                            .attr("sodipodi:sodipodi:rx", "50.507626")
                            .attr("sodipodi:sodipodi:cy", "75.54467")
                            .attr("sodipodi:sodipodi:cx", "83.842659")
                            .attr("sodipodi:sodipodi:type", "arc")
                            .attr("d", "m 134.35028,75.54467 c 0,27.89459 -22.61303,50.50763 -50.507621,50.50763 -27.894591,0 -50.507626,-22.61304 -50.507626,-50.50763 0,-27.894591 22.613035,-50.507625 50.507626,-50.507625 27.894591,0 50.507621,22.613034 50.507621,50.507625 z")
                            .style("opacity", 0.7)
                            .style("fill", function(d) { return d3.rgb(color(calcColor(d))).brighter().toString() })
                            .style("filter", "url(#filter3859)");
                    newParent.selectAll(".outter").append("path")
                            .attr("sodipodi:sodipodi:type", "star")
                            .attr("style", "fill:#ffffff;fill-opacity:1")
                            .attr("sodipodi:sodipodi:sides", "9")
                            .attr("sodipodi:sodipodi:cx", "408.802")
                            .attr("sodipodi:sodipodi:cy", "662.41638")
                            .attr("sodipodi:sodipodi:r1", "34.595016")
                            .attr("sodipodi:sodipodi:r2", "0.80043751")
                            .attr("sodipodi:sodipodi:arg1", "1.2736714")
                            .attr("sodipodi:sodipodi:arg2", "1.6227373")
                            .attr("d", "m 418.93047,695.49552 -10.17002,-32.27978 -13.46246,31.05118 12.95836,-31.26491 -30.27215,15.13309 30.02337,-15.62084 -32.91717,-7.86594 33.04012,7.33239 -20.15989,-27.18441 20.59703,26.85472 2.03043,-33.783 -1.48364,33.81142 23.27069,-24.57413 -22.8701,24.94738 33.62234,-3.86677 -33.55538,4.41019 28.24172,18.64991 -28.53973,-18.19058 z")
                            .attr("transform", "matrix(0.60865681,-0.02610034,0.02610034,0.60865681,-125.24117,-338.82995)");
                    newParent.selectAll(".outter").append("path")
                            .attr("sodipodi:sodipodi:type", "arc")
                            .attr("style", "fill:#ffffff;fill-opacity:1;filter:url(#filter3831)")
                            .style("fill", function(d) { return color(calcColor(d)) })
                            .attr("sodipodi:sodipodi:cx", "83.842659")
                            .attr("sodipodi:sodipodi:cy", "75.54467")
                            .attr("sodipodi:sodipodi:rx", "50.507626")
                            .attr("sodipodi:sodipodi:ry", "50.507626")
                            .attr("d", "m 134.35028,75.54467 c 0,27.89459 -22.61303,50.50763 -50.507621,50.50763 -27.894591,0 -50.507626,-22.61304 -50.507626,-50.50763 0,-27.894591 22.613035,-50.507625 50.507626,-50.507625 27.894591,0 50.507621,22.613034 50.507621,50.507625 z")
                            .attr("transform", "matrix(0.1885681,0,0,0.1885681,124.60115,39.075996)");
                    newParent.selectAll(".outter").append("path")
                            .attr("transform", "matrix(0.39032722,0,0,0.39032722,107.68513,23.83417)")
                            .attr("sodipodi:sodipodi:ry", "50.507626")
                            .attr("sodipodi:sodipodi:rx", "50.507626")
                            .attr("sodipodi:sodipodi:cy", "75.54467")
                            .attr("sodipodi:sodipodi:cx", "83.842659")
                            .attr("sodipodi:sodipodi:type", "arc")
                            .attr("d", "m 134.35028,75.54467 c 0,27.89459 -22.61303,50.50763 -50.507621,50.50763 -27.894591,0 -50.507626,-22.61304 -50.507626,-50.50763 0,-27.894591 22.613035,-50.507625 50.507626,-50.507625 27.894591,0 50.507621,22.613034 50.507621,50.507625 z")
                            .style("fill-opacity", 0.7)
                            .style("fill", "url(#radialGradient3982)")
                            .style("filter", "url(#filter3831)");
                    newParent.selectAll(".outter").append("path")
                            .attr("transform", "matrix(0.39032722,0,0,0.39032722,107.68513,23.83417)")
                            .attr("sodipodi:sodipodi:ry", "50.507626")
                            .attr("sodipodi:sodipodi:rx", "50.507626")
                            .attr("sodipodi:sodipodi:cy", "75.54467")
                            .attr("sodipodi:sodipodi:cx", "83.842659")
                            .attr("sodipodi:sodipodi:type", "arc")
                            .attr("d", "m 134.35028,75.54467 c 0,27.89459 -22.61303,50.50763 -50.507621,50.50763 -27.894591,0 -50.507626,-22.61304 -50.507626,-50.50763 0,-27.894591 22.613035,-50.507625 50.507626,-50.507625 27.894591,0 50.507621,22.613034 50.507621,50.507625 z")
                            .style("fill-opacity", 0.7)
                            .style("fill", "url(#radialGradient3982)")
                            .style("filter", "url(#filter3831)");
                    newParent.transition()
                            .delay(100)
                            .style("opacity", 1);
                    break;
                case 1 :
                    newParent = parent.append("g")
                            .attr("class", "stars1");
                    newParent.append("g")
                            .attr("transform", "translate(-52, -52)")
                            .append("g")
                            .attr("class", "outter")
                            .attr("transform", "translate(-332.30773,-562.38891)")
                            .append("path")
                            .attr("d", "m 412.46549,642.0517 -27.56005,-26.9168 -0.45485,38.52095 -0.45484,-38.52095 -27.56006,26.9168 26.91681,-27.56005 -38.52095,-0.45485 38.52095,-0.45484 -26.9168,-27.56005 27.56005,26.9168 0.45485,-38.52095 0.45484,38.52095 27.56005,-26.9168 -26.9168,27.56005 38.52095,0.45485 -38.52095,0.45484 z")
                            .attr("sodipodi:sodipodi:arg2", "1.1780974")
                            .attr("sodipodi:sodipodi:arg1", "0.78539824")
                            .attr("sodipodi:sodipodi:r2", "1.1885713")
                            .attr("sodipodi:sodipodi:r1", "39.619045")
                            .attr("sodipodi:sodipodi:cy", "614.0368")
                            .attr("sodipodi:sodipodi:cx", "384.45059")
                            .attr("sodipodi:sodipodi:sides", "8")
                            .attr("sodipodi:sodipodi:type", "star")
                            .attr("style", function(d) {return "fill:" + color(calcColor(d)) + ";filter:url(#filter5909)"});
                    newParent.selectAll(".outter").append("path")
                            .attr("d", "m 415.91347,628.69075 -28.03151,-12.30866 8.45434,30.26423 -11.11773,-28.5248 -15.42192,27.37816 12.30865,-28.0315 -30.26423,8.45433 28.52481,-11.11773 -27.37817,-15.42192 28.03151,12.30866 -8.45434,-30.26424 11.11773,28.52481 15.42193,-27.37816 -12.30866,28.0315 30.26423,-8.45434 -28.5248,11.11774 z")
                            .attr("sodipodi:sodipodi:arg2", "0.59955522")
                            .attr("sodipodi:sodipodi:arg1", "0.43587706")
                            .attr("sodipodi:sodipodi:r2", "4.1562829")
                            .attr("sodipodi:sodipodi:r1", "34.70808")
                            .attr("sodipodi:sodipodi:cy", "614.0368")
                            .attr("sodipodi:sodipodi:cx", "384.45059")
                            .attr("sodipodi:sodipodi:sides", "8") //#deffff
                            .attr("style", function(d) {return "fill:" + d3.rgb(color(calcColor(d))).brighter().toString() + ";fill-opacity:1;filter:url(#filter4888-1)"})
                            .attr("sodipodi:sodipodi:type", "star")
                            .attr("transform", "translate(-7.0792635e-6,0.86198797)");
                    break;
                case 2 :
                    var defs = d3.selectAll("#starsZeroGr");
                    if (defs)
                        defs.remove();
                    defs = svg.append("defs").attr("id", "starsZeroGr");

                    var makeGrad = function(d, type) {
                        if (!type)
                            type = 0;

                        defs.append("radialGradient")
                                .attr("xlink:xlink:href", "#lg_st_" + type + "_" + d.index)
                                .attr("id", "rg_st_" + type + "_" + d.index)
                                .attr("cx", "398.24252")
                                .attr("cy", "662.73962")
                                .attr("fx", "398.24252")
                                .attr("fy", "662.73962")
                                .attr("r", type ? "47.601433" : "31.487122")
                                .attr("gradientTransform", type ? "matrix(1,0,0,1.0336521,0,-22.302595)" : "matrix(1,0,0,1.0302824,0,-20.069346)")
                                .attr("gradientUnits", "userSpaceOnUse");

                        var lin = defs.append("linearGradient")
                                .attr("id", "lg_st_" + type + "_" + d.index);
                        lin.append("stop")
                                .attr("offset","0")
                                .attr("style", "stop-color:#deffff;stop-opacity:1;")
                                .style("stop-color", color(calcColor(d)));
                        lin.append("stop")
                                .attr("offset","1")
                                .attr("style", "stop-color:#deffff;stop-opacity:0;")
                                .style("stop-color", color(calcColor(d)));

                        return "url(#rg_st_" + type + "_" + d.index + ")";
                    }

                    newParent = parent.append("g")
                            .attr("class", "stars0");
                    newParent.append("g")
                            .attr("transform", "translate(-98, -58)")
                            .append("g")
                            .attr("class", "outter")
                            .attr("transform", "translate(-309.89778,-605.66567)")
                            .append("path")
                            .attr("transform", "matrix(3.1757535,0,0,1,-854.82231,-0.388021)")
                            .attr("d", "m 410.74148,679.54857 -10.62929,-11.26426 -1.63785,15.40074 -1.97831,-15.36072 -10.37737,11.49676 7.42831,-13.5899 -15.15309,3.2014 13.99757,-6.62821 -14.14084,-6.31677 15.22023,2.86523 -7.72727,-13.42216 10.62928,11.26426 1.63785,-15.40074 1.97831,15.36071 10.37738,-11.49675 -7.42832,13.5899 15.1531,-3.2014 -13.99758,6.6282 14.14085,6.31678 -15.22024,-2.86523 z")
                            .attr("sodipodi:sodipodi:arg2", "1.2455696")
                            .attr("sodipodi:sodipodi:arg1", "0.93141043")
                            .attr("sodipodi:sodipodi:r2", "5.8514285")
                            .attr("sodipodi:sodipodi:r1", "20.946705")
                            .attr("sodipodi:sodipodi:cy", "662.73962")
                            .attr("sodipodi:sodipodi:cx", "398.24252")
                            .attr("sodipodi:sodipodi:sides", "10")
                            .attr("style", "opacity:0.7;" +
                                           "fill:url(#radialGradient6179);" +
                                           "fill-opacity:1;" +
                                           "filter:url(#filter6197)")
                            .style("fill", function(d) { return makeGrad(d, 0) })
                            .attr("sodipodi:sodipodi:type", "star");
                    newParent.selectAll(".outter").append("path")
                            .attr("sodipodi:sodipodi:type", "star")
                            .style("fill", function(d) { return color(curType = (calcColor(d))) })
                            .style("fill-opacity", "1")
                            .attr("sodipodi:sodipodi:sides", "9")
                            .attr("sodipodi:sodipodi:cx", "408.802")
                            .attr("sodipodi:sodipodi:cy", "662.41638")
                            .attr("sodipodi:sodipodi:r1", "34.595016")
                            .attr("sodipodi:sodipodi:r2", "0.80043751")
                            .attr("sodipodi:sodipodi:arg1", "1.2736714")
                            .attr("sodipodi:sodipodi:arg2", "1.6227373")
                            .attr("d", "m 418.93047,695.49552 -10.17002,-32.27978 -13.46246,31.05118 12.95836,-31.26491 -30.27215,15.13309 30.02337,-15.62084 -32.91717,-7.86594 33.04012,7.33239 -20.15989,-27.18441 20.59703,26.85472 2.03043,-33.783 -1.48364,33.81142 23.27069,-24.57413 -22.8701,24.94738 33.62234,-3.86677 -33.55538,4.41019 28.24172,18.64991 -28.53973,-18.19058 z");
                    newParent.selectAll(".outter").append("path")
                            .attr("sodipodi:type", "star")
                            .attr("style", "fill:url(#radialGradient6187);" +
                                           "fill-opacity:1;" +
                                           "filter:url(#filter6115)")
                            .style("fill", function(d) { return makeGrad(d, 1) })
                            .attr("sodipodi:sodipodi:sides", "9")
                            .attr("sodipodi:sodipodi:cx", "398.24252")
                            .attr("sodipodi:sodipodi:cy", "662.73962")
                            .attr("sodipodi:sodipodi:r1", "49.886093")
                            .attr("sodipodi:sodipodi:r2", "5.8514285")
                            .attr("sodipodi:sodipodi:arg1", "0.87716425")
                            .attr("sodipodi:sodipodi:arg2", "1.2262301")
                            .attr("d", "m 430.13641,701.09849 -29.91734,-32.85137 -2.20101,44.37809 -1.80156,-44.3961 -30.21177,32.58081 27.15719,-35.16741 -44.08609,5.5386 43.40879,-9.48349 -37.33205,-24.09518 39.34893,20.63785 -13.10992,-42.45456 16.87727,41.10252 17.24648,-40.94897 -13.49145,42.33486 39.53306,-20.28292 -37.54737,23.75825 43.32169,9.87375 -44.03447,-5.93511 z")
                            .attr("transform", "translate(10.469284,-0.46332952)");
                   break;
                case 3 :
                    newParent = parent.append("g")
                            .attr("class", "stars3");
                    newParent.append("g")
                            .attr("class", "inner")
                            .attr("transform", "translate(-25, -25)")
                            .append("g")
                            .attr("class", "outter")
                            .attr("transform", "translate(-1070.6413,-990.16135)")
                            /*.append("path")
                            .attr("d", "m 1113.955,1017.268 c -0.277,10.904 -9.307,19.514 -20.211,19.292 -10.887,-0.256 -19.529,-9.322 -19.273,-20.229 0.26,-10.887 9.305,-19.531 20.213,-19.271 10.904,0.254 19.513,9.303 19.271,20.208 z")
                            .style("opacity", 0.2)
                            .style("fill", function(d) {
                                return d3.rgb(color(calcColor(d)))
                                        .brighter()
                                        .toString()
                            });
                    newParent.selectAll(".outter").append("path")
                            .attr("d", "m 1111.912,1017.213 c -0.219,9.782 -8.363,17.509 -18.111,17.287 -9.783,-0.222 -17.527,-8.35 -17.287,-18.132 0.221,-9.766 8.328,-17.51 18.113,-17.271 9.766,0.222 17.527,8.35 17.285,18.116 z")
                            .style("opacity", 0.2)
                            .style("fill", function(d) {
                                return d3.rgb(color(calcColor(d)))
                                        .brighter()
                                        .toString()
                            });
                    newParent.selectAll(".outter").append("path")
                            .attr("d", "m 1107.834,1017.14 c -0.188,7.501 -6.422,13.462 -13.943,13.279 -7.52,-0.184 -13.459,-6.422 -13.293,-13.94 0.166,-7.539 6.418,-13.479 13.938,-13.296 7.521,0.166 13.46,6.418 13.298,13.957 z")
                            .style("opacity", 0.2)
                            .style("fill", function(d) {
                                return d3.rgb(color(calcColor(d)))
                                        .brighter()
                                        .toString()
                            });*/
                    newParent.selectAll(".outter").append("path")
                            .style("opacity", 0.4)
                            .attr("d", "m 1102.371,1016.991 c -0.094,4.524 -3.828,8.093 -8.35,7.982 -4.541,-0.111 -8.094,-3.863 -7.982,-8.35 0.09,-4.524 3.844,-8.09 8.367,-7.979 4.524,0.09 8.076,3.826 7.965,8.347 z")
                            .style("fill", function(d) { return color(calcColor(d)) });

                    newParent.selectAll(".inner")
                            .append("g")
                            .attr("class", "outter1")
                            .attr("transform", "matrix(0.95767353,0,0,0.95767353,-393.20808,-433.63763)")
                            .append("g")
                            .attr("transform", "matrix(1.25,0,0,-1.25,452.07562,480.62886)")
                            .append("path")
                            .attr("d", "M 0,0 C -14.945,0.799 -14.298,1.447 -13.5,-13.5 -12.701,1.447 -12.053,0.799 -27.001,0 -12.053,-0.799 -12.701,-1.446 -13.5,13.5 -14.298,-1.446 -14.945,-0.799 0,0")
                            .attr("style", "fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none")
                            .style("fill", function(d) {
                                return d3.rgb(color(calcColor(d)))
                                        .brighter()
                                        .brighter()
                                        .brighter()
                                        .toString()
                            });
                    newParent.selectAll(".outter1")
                            .append("g")
                            .attr("transform", "matrix(1.25,0,0,-1.25,111.99012,763.50118)")
                            .append("g")
                            .attr("clip-path", "url(#clipPath116341)")
                            .style("opacity", "0.5")
                            .append("g")
                            .attr("transform", "translate(262.6494,226.2979)")
                            .append("path")
                            .attr("d", "m 0,0 c 0,-2.252 -1.829,-4.08 -4.079,-4.08 -2.255,0 -4.083,1.828 -4.083,4.08 0,2.253 1.828,4.079 4.083,4.079 C -1.829,4.079 0,2.253 0,0")
                            .attr("style", "fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none")
                            .style("fill", function(d) {
                                return d3.rgb(color(calcColor(d)))
                                        .brighter()
                                        .brighter()
                                        .brighter()
                                        .toString()
                            });
                    break;
                default:
                        newParent.append("circle")
                            .attr("r", 0)
                            .style("fill", function(d) { return color(calcColor(d)); })
                            .style("stroke", function(d) { return d3.rgb(color(calcColor(d))).darker().toString() })
                            .style("stroke-width", function(d) { return sw(d.size) * edgeSizeFactor})
                            .transition()
                            .delay(100)
                            .duration(1000)
                            .attr("r", function(d) { return radius(d.size) * nodeSizeFactor; });
                    break;
            }
            parent.append("text")
                .attr("class", "nodelabel")
                .attr("text-anchor", "middle")
                .style("stroke", function(d) { return d3.rgb(color(calcColor(d))).darker().darker().toString() })
                .style("fill", "#fff")
                .text(function(d) { return d.label })
                .attr("dy", ".35em")
                .style("stroke-width", function(d) { return sw(d.size) * edgeSizeFactor / lastZoom})
                .style("font-size", 24 / lastZoom + "pt")
                .style("visibility", function(d) { return d.type == 0 && showLabelOnRoot ? null : "hidden"});

            return newParent;
        }

        var timerClick = false;
        function buttonStarOffOn() {
            var but = d3.select("body").select("svg").selectAll("#starOnOff")
                        .data([{check : !showAsBall}])
                        .enter()
                        .append("g")
                        .attr("transform", "scale(1)translate(33, 20)")
                        .attr("id", "starOnOff")
                        .attr("class", "button")
                    .on("click", function(d) {
                        d.check = !d.check;
                        showAsBall = !d.check;
                        if (timerClick) {
                            clearTimeout(timerClick);
                            timerClick = false;
                        }
                        timerClick = setTimeout(tick_end, 500);

                        if (showAsBall)
                            toCircle();
                        else
                            toStar();

                        var item = d3.select(this);
                        item.select("title").text("stars " + (!showAsBall ? "off" : "on"));
                        item.select("text").text("stars " + (showAsBall ? "off" : "on"));
                        item.select(".outter").selectAll("path")
                                .style("fill", !showAsBall ? "#90E89B" : "#FBA09C");
                        item.select(".outter1").selectAll("path")
                                .style("fill", d3.rgb(!showAsBall ?  "#90E89B" : "#FBA09C")
                                    .brighter()
                                    .brighter()
                                    .brighter()
                                    .toString());
                    });
            but.append("title").text("stars " + (!showAsBall ? "off" : "on"));
            but.append("text")
                    .style("fill", "#fff")
                    .attr("dy", "30px")
                    .attr("dx", "5px")
                    .attr("text-anchor", "middle")
                    .text("stars " + (showAsBall ? "off" : "on"));

            function toStar() {
                but.selectAll("g").remove();
                but.append("g")
                    .attr("class", "inner")
                    .attr("transform", "translate(-18, -21)")
                    .append("g")
                    .attr("class", "outter")
                    .attr("transform", "translate(-1070.6413,-990.16135)")
                but.selectAll(".outter").append("path")
                    .style("opacity", 0.4)
                    .attr("d", "m 1102.371,1016.991 c -0.094,4.524 -3.828,8.093 -8.35,7.982 -4.541,-0.111 -8.094,-3.863 -7.982,-8.35 0.09,-4.524 3.844,-8.09 8.367,-7.979 4.524,0.09 8.076,3.826 7.965,8.347 z")
                    .style("fill", !showAsBall ? "#90E89B" : "#FBA09C");
                but.selectAll(".inner")
                    .append("g")
                    .attr("class", "outter1")
                    .attr("transform", "matrix(0.95767353,0,0,0.95767353,-393.20808,-433.63763)")
                    .append("g")
                    .attr("transform", "matrix(1.25,0,0,-1.25,452.07562,480.62886)")
                    .append("path")
                    .attr("d", "M 0,0 C -14.945,0.799 -14.298,1.447 -13.5,-13.5 -12.701,1.447 -12.053,0.799 -27.001,0 -12.053,-0.799 -12.701,-1.446 -13.5,13.5 -14.298,-1.446 -14.945,-0.799 0,0")
                    .attr("style", "fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none")
                    .style("fill", function(d) {
                        return d3.rgb(!showAsBall ?  "#90E89B" : "#FBA09C")
                                .brighter()
                                .brighter()
                                .brighter()
                                .toString()
                    });
                but.selectAll(".outter1")
                    .append("g")
                    .attr("transform", "matrix(1.25,0,0,-1.25,111.99012,763.50118)")
                    .append("g")
                    .attr("clip-path", "url(#clipPath116341)")
                    .style("opacity", "0.5")
                    .append("g")
                    .attr("transform", "translate(262.6494,226.2979)")
                    .append("path")
                    .attr("d", "m 0,0 c 0,-2.252 -1.829,-4.08 -4.079,-4.08 -2.255,0 -4.083,1.828 -4.083,4.08 0,2.253 1.828,4.079 4.083,4.079 C -1.829,4.079 0,2.253 0,0")
                    .attr("style", "fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none")
                    .style("fill", function(d) {
                        return d3.rgb(!showAsBall ?  "#90E89B" : "#FBA09C")
                                .brighter()
                                .brighter()
                                .brighter()
                                .toString()
                    });
            }

            function toCircle() {
                but.selectAll("g").remove();
                but.append("g")
                    .attr("transform", "translate(5, 5)")
                    .append("circle")
                    .style("fill", !showAsBall ? "#90E89B" : "#FBA09C")
                    .style("stroke", d3.rgb(!showAsBall ? "#90E89B" : "#FBA09C").darker().toString())
                    .style("stroke-width", 1.5)
                    .attr("r", 10);
            }

            if (showAsBall)
                toCircle();
            else
                toStar();
        }

        var timerStat = false;
        function buttonStat() {
            var but = d3.select("body").select("svg").selectAll("#statOffOn")
                .data([{check : false}])
                .enter()
                .append("g")
                .attr("transform", "scale(1)translate(20, 80)")
                .attr("id", "statOffOn")
                .attr("class", "button")
                    .on("click", function(d) {
                        var item = d3.select(this);
                        d.check = !d.check;
                        if (d.check)
                            show();
                        else
                            hide();
                        chTxt(item);
                    });

            function chTxt(item) {
                item.select("title")
                    .text(function(d) {return "statistics " + (!d.check ? "show" : "hide")});
                item.select("text")
                    .text(function(d) {return "statistics " + (!d.check ? "show" : "hide")});
            }

            but.append("title");
            but.append("text")
                    .style("fill", "#fff")
                    .attr("dy", "30px")
                    .attr("dx", "20px")
                    .attr("text-anchor", "middle");
            chTxt(but);

            but = but.append("g")
                    .attr("transform", "scale(0.8)translate(2,-22)");
            but.append("rect")
                    .attr("y", "-2.7421434")
                    .attr("x", "-2.5253813")
                    .attr("height", "47.477169")
                    .attr("width", "53.033009")
                    .attr("style", "fill:#000000;fill-opacity:0.1;stroke:none");
            but.append("path")
                    .attr("d", "M 1.515229,41.199484 13.131983,13.420289 17.67767,23.016738 38.385797,9.379679")
                    .attr("style", "fill:none;stroke:#B5E2F7;stroke-width:1px;");
            but.append("path")
                    .attr("d", "m 0.505076,15.945671 4.545687,6.060915 2.525381,12.626907 15.152288,-3.535534 9.596449,-12.121831 6.565992,14.647212")
                    .attr("style", "fill:none;stroke:#00ff00;stroke-width:1px");
            but.append("path")
                    .attr("d", "m 38.385797,37.411411 c 0,3.486824 -2.6005,6.313453 -5.808378,6.313453 -3.207878,0 -5.808377,-2.826629 -5.808377,-6.313453 0,-3.486824 2.600499,-6.313453 5.808377,-6.313453 3.207878,0 5.808378,2.826629 5.808378,6.313453 z")
                    .attr("transform", "matrix(0.59999999,0,0,0.59999999,-0.101015,-7.763867)")
                    .attr("style", "fill:#c83737");
            but.append("path")
                    .attr("d", "m 45.456866,59.382229 c 0,2.510513 -1.809043,4.545686 -4.04061,4.545686 -2.231568,0 -4.04061,-2.035173 -4.04061,-4.545686 0,-2.510513 1.809042,-4.545686 4.04061,-4.545686 2.231567,0 4.04061,2.035173 4.04061,4.545686 z")
                    .attr("transform", "translate(-10.606602,-28.284271)")
                    .attr("style", "fill:#ffff00");
            but.append("path")
                    .attr("d", "m 1.515229,0.288307 -1.010153,41.416254 0,0 46.972093,-1.010153")
                    .attr("style", "fill:none;stroke:#a8afbd;stroke-width:1px;");


            function show() {
                resize();
                divstat = d3.select("body")
                        .insert("div", ":first-child")
                        .style("width", width() - 40 * 2 + "px")
                        .style("height", height() - 40 * 1.6 + "px")
                        .attr("id", "statwindow")
                        .style("top", "40px")
                        .style("left", "40px");
            }

            function hide() {
                d3.select("#statwindow").remove();
            }
        }

        function buttonLabelRoot() {
            var but = d3.select("body").select("svg").selectAll("#labelRootOffOn")
                .data([{check : showLabelOnRoot}])
                .enter()
                .append("g")
                .attr("transform", "scale(1)translate(37, 140)")
                .attr("id", "labelRootOffOn")
                .attr("class", "button")
                    .on("click", function(d) {
                        var item = d3.select(this);
                        showLabelOnRoot = d.check = !d.check;
                        chTxt(item);
                        refresh();
                    });

            function chTxt(item) {
                item.select("title")
                    .text(function(d) {return (!d.check ? "show" : "hide") + " label on games"});
                item.select("text")
                    .text(function(d) {return (!d.check ? "show" : "hide")});
            }

            but.append("title");
            but.append("text")
                    .style("fill", "#fff")
                    .attr("dy", "20px")
                    .attr("text-anchor", "middle");
            but.append("text")
                    .attr("y","0")
                    .attr("x","0")
                    .attr("text-anchor", "middle")
                    .attr("style", "font-size:24px;font-weight:bold;line-height:125%;fill:#aaaaff;fill-opacity:1;stroke:none;opacity:1")
                    .text("label");
            chTxt(but);
        }

        var timerOpHighLow = false;

        function hideSelectedNode(d) {
            if (timerOpHighLow) {
                clearTimeout(timerOpHighLow);
                timerOpHighLow = false;
            }

            var havevis = svgnode.selectAll(".overnode").length > 0;
            svgnode.selectAll(".overnode").remove();
            if (havevis)
                timerOpHighLow = setTimeout(function () {
                    svgnode.selectAll(".node")
                            .style("opacity", 1);
                }, 200);
            hideedges();
        }

        function showSelectedNode(m, conteiner, typeNode) {
            if (timerOpHighLow) {
                clearTimeout(timerOpHighLow);
                timerOpHighLow = false;
            }

            resize();

            proc = 0;

            conteiner = false;

            svgnode.selectAll(".overnode").remove();

            var havevis = false;

            m.values
                    .forEach(function (d) {
                        d.visibile = vis(d.rx, d.ry);
                        if (havevis = d.visibile) {
                            svgnode.append("g")
                                    .on("mouseover", showedges)
                                    .on("mouseout", hideedges)
                                    .attr("class", "overnode")
                                    .datum(d);
                        }
                    })

            var node = svgnode.selectAll(".overnode");

            if (!conteiner) {
                conteiner = makeStars(node.filter(function (d) {
                    return d.type == typeNode && this.childNodes.length < 1
                }), showAsBall ? 5 : typeNode);
                if (showAsBall)
                    conteiner = false;
            }


            translateNode(node);
            refresh();
            if (havevis)
                timerOpHighLow = setTimeout(function () {
                    svgnode.selectAll(".node")
                            .style("opacity", .3);
                }, 200);
            showedges(m.values);
        }

        function initFilters(id, typeNode, nodeObject, paddingCoff, colors) {
            d3.select(id)
                    .selectAll("li")
                    .data(d3.nest()
                        .key(function(d) { return d.label; })
                        .entries(graph.nodes
                        .filter(function(d) { return d.type == typeNode; })
                        .sort(function(a, b) { return d3.ascending(a.label, b.label); }))
                    )
                    .enter().append("li")
                    .append("a")
                    .attr("href", function(d) {
                        return "#" + d.key;
                    })
                    .html(function(d) { return "<span>" + d.key + "</span>"})
                    .on("click", function() {
                        d3.event.preventDefault();
                    })
                    .on("mouseover", function(m) {
                        showSelectedNode(m, nodeObject, typeNode);
                    })
                    .on("mouseout", hideSelectedNode)
                    .insert("span", ":first-child")
                    .text(function(d) {
                        return d.values.length;
                    })
                    .style("background", function(d) {
                        return colors(d.values.length);
                    })
                    .style("border-color", function(d) {
                        return d3.rgb(colors(d.values.length)).darker().darker().darker().toString();
                    })
                    .style("padding-left", function(d) {
                        return d.values.length * paddingCoff + "px";
                    });
            d3.select(d3.select(id).node().parentNode)
                    .select("h3")
                    .style("cursor", "pointer")
                    .on("click", function(d) {
                        d3.select(this.parentNode)
                                .classed("show", function() {
                                    var s = d3.select(this).classed("show") ? false : true;
                                    d3.select(this.parentNode)
                                        .selectAll("li.show").classed("show", false);
                                    return s;
                                });
                    });
        }
    });
}
</script>
</body>
</html>